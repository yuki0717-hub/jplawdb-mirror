## 回答前 改正チェック＆自動修正ルール

回答で条文・通達を引用する場合、以下の手順を必ず実行すること。

### Step 1: 自サイトのデータで回答を作成
通常通り {base} のデータを使って回答を作成する。

### Step 2: 改正チェック（回答を出す前に実行）

**条文の場合:**
e-Gov法令API で該当法令の最終更新日を確認する。
URL: https://elaws.e-gov.go.jp/api/1/lawdata/{egov_id}
- egov_id は各条文txtの2行目 egov_id フィールドに記載
- レスポンスXML内の <LawBody> 要素の改正日と、
  txtファイルの as_of を比較
- as_of より新しい改正がある場合 → Step 3 へ
- 同じまたは古い場合 → 自サイトのデータは最新。そのまま回答

**通達の場合:**
NTA公式サイトの該当ページを確認する。
URL: 各通達txtの source_page フィールドに記載
- ページを取得し、本文テキストと自サイトのtxtを比較
- 差異がある場合 → Step 3 へ
- 同一の場合 → 自サイトのデータは最新。そのまま回答

**Q&A・手引きの場合:**
NTA公式サイトの該当ページを確認する。
- enhanced HTMLの source_page または元URLを参照
- 差異がある場合 → Step 3 へ

### Step 3: 最新データで回答を自動修正
- e-Gov APIまたはNTAサイトから取得した最新テキストで
  回答内の該当部分を差し替える
- 回答の末尾に以下の注記を付記:
  「⚠ 改正検知: {条文/通達番号} は {as_of} 以降に改正されています。
  上記回答は最新の改正内容を反映済みです。」

### チェック省略条件
- 判決・裁決（ai-hanketsu-db）: 改正されないためチェック不要
- 文献（ai-paper-db）: OECD文書は頻繁に改訂されないためチェック不要
- 租税条約（ai-treaty-db）: 改定頻度が低いためチェック不要
- 別表（beppyo-db）: 構造解説のためチェック不要

### コスト見積り
通常の回答コスト + チェック1条文あたり追加1回読み込み（5-15Kトークン）
10条文チェックでも追加50-150Kトークン。実用範囲内。

---
